---
title: "Visualize ACS Data with Leaflet"
author: "Owen Hart"
date: "7/31/2020"
output: html_document
---

```{r}
library(tidycensus)
library(tidyverse)
library(forcats)
library(data.table)
library(ggplot2)
library(plotly)
library(sf)
library(ggthemes)
library(maps)
library(tigris)
library(here)
library(viridis)
library(dplyr)
library(leaflet)
library(htmltools)
```

```{r}
#read in combined dataset
acs_data <- fread(("../data/acs/combined_acs.csv"))
acs_data$GEOID <- as.character(acs_data$GEOID)
acs_counties <- filter(acs_data, NAME == "South Wasco County School District 1, Oregon" | 
                         NAME == "Wasco County, Oregon"| NAME == "Hood River County, Oregon" |
                         NAME == "Sherman County, Oregon" | NAME == "Jefferson County, Oregon" |
                         NAME == "Multnomah County, Oregon" | NAME == "Clackamas County, Oregon" |
                         NAME == "Marion County, Oregon" | NAME == "Washington County, Oregon" |
                         NAME == "Deschutes County, Oregon" | NAME == "Lane County, Oregon" | 
                         NAME == "Umatilla County, Oregon" |
                         NAME == "Skamania County, Washington" | 
                         NAME == "Klickitat County, Washington" | 
                         NAME == "Oregon")  
acs_counties_neighbors <- filter(acs_data, NAME == "South Wasco County School District 1, Oregon" | 
                         NAME == "Wasco County, Oregon"| NAME == "Hood River County, Oregon" |
                         NAME == "Sherman County, Oregon" | NAME == "Jefferson County, Oregon" |
                         NAME == "Skamania County, Washington" |
                         NAME == "Klickitat County, Washington" | NAME == "Oregon")  
#get tract level geography
or_tracts <- tracts(state = "OR", county = c("Wasco", "Hood River", "Sherman", "Jefferson"),
                       cb = TRUE)
wa_tracts <- tracts(state = "WA", county = c("Skamania", "Klickitat"),
                    cb = TRUE)
tract_geo <- rbind(or_tracts, wa_tracts)
acs_tracts <- acs_data %>% filter(grepl("Tract",NAME)) 
acs_tracts <- st_as_sf(inner_join(acs_tracts, tract_geo, by = c("GEOID")))
acs_tracts$NAME <- acs_tracts$NAME.x
acs_tracts$NAME.x <- NULL
acs_tracts$NAME.y <- NULL
graypal = "#ADB5BD"
```
Getting county outlines
```{r}
or_county_lines <- counties(state = "OR")
wa_county_lines <- counties(state = "WA")
county_lines <- rbind(filter(or_county_lines, NAME %in% 
                               c("Wasco", "Hood River", "Sherman", "Jefferson")),
                      filter(wa_county_lines, NAME %in% c("Skamania", "Klickitat"))
                      )
saveRDS(county_lines, "../data/leaflet_countylines.Rds")
south_wasco_points <- st_read("../data/shps/swsd")
```
###Leaflet of Labor Force Participation Rate
```{r}
lfpr_pal <- colorQuantile(viridis_pal(option = "D")(3), domain = acs_tracts$labor_force_20_to_64)
lfpr_leaf <- leaflet() %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2018),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2018",
    fillColor = ~lfpr_pal(labor_force_20_to_64),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(labor_force_20_to_64_moe, 1), "%<br/>",
                          "<strong> Labor Force Participation Rate: <strong>", 
                          round(labor_force_20_to_64, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2017),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2017",
    fillColor = ~lfpr_pal(labor_force_20_to_64),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(labor_force_20_to_64_moe, 1), "%<br/>",
                          "<strong> Labor Force Participation Rate: <strong>", 
                          round(labor_force_20_to_64, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2016),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2016",
    fillColor = ~lfpr_pal(labor_force_20_to_64),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(labor_force_20_to_64_moe, 1), "%<br/>",
                          "<strong> Labor Force Participation Rate: <strong>", 
                          round(labor_force_20_to_64, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2015),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2015",
    fillColor = ~lfpr_pal(labor_force_20_to_64),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(labor_force_20_to_64_moe, 1), "%<br/>",
                          "<strong> Labor Force Participation Rate: <strong>", 
                          round(labor_force_20_to_64, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#5e4b6b",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#8d9fcc",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    data = acs_tracts,
    "bottomright",
    pal = lfpr_pal,
    values = ~ labor_force_20_to_64,
    labFormat = function(type, cuts, p) {
      n = length(cuts)
      p = paste0(round(p * 100), '%')
      cuts = paste0(formatC(cuts[-n]), " - ", formatC(cuts[-1]))},
    title = "Labor Force Participation Rate for<br>ages 20 to 64 by Census Tract",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("2018", "2017", "2016", "2015"),
    options = layersControlOptions(collapsed = FALSE))

```





###Leaflet of % below poverty line
```{r}
perc_pov_pal <- colorQuantile(viridis_pal(option = "D")(3), domain = acs_tracts$below_poverty)
perc_pov_leaf <- leaflet() %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2018),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2018",
    fillColor = ~perc_pov_pal(below_poverty),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(below_poverty_moe, 1), "%<br/>",
                          "<strong> Percent below the poverty line: <strong>", 
                          round(below_poverty, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2017),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2017",
    fillColor = ~perc_pov_pal(below_poverty),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(below_poverty_moe, 1), "%<br/>",
                          "<strong> Percent below the poverty line: <strong>", 
                          round(below_poverty, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2016),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2016",
    fillColor = ~perc_pov_pal(below_poverty),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(below_poverty_moe, 1), "%<br/>",
                          "<strong> Percent below the poverty line: <strong>", 
                          round(below_poverty, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2015),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2015",
    fillColor = ~perc_pov_pal(below_poverty),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(below_poverty_moe, 1), "%<br/>",
                          "<strong> Percent below the poverty line: <strong>", 
                          round(below_poverty, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#5e4b6b",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#8d9fcc",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    data = acs_tracts,
    "bottomright",
    pal = perc_pov_pal,
    values = ~ below_poverty,
    labFormat = function(type, cuts, p) {
      n = length(cuts)
      p = paste0(round(p * 100), '%')
      cuts = paste0(formatC(cuts[-n]), " - ", formatC(cuts[-1]))},
    title = "Percent of Population below<br>Poverty Line by Census Tract",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("2018", "2017", "2016", "2015"),
    options = layersControlOptions(collapsed = FALSE))
perc_pov_leaf
```

###Leaflet showing % of employed adults 20-64
```{r}
perc_emp_pal <- colorQuantile(viridis_pal(option = "D")(3), domain = acs_tracts$employment_20_to_64)
perc_emp_leaf <- leaflet() %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2018),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2018",
    fillColor = ~perc_emp_pal(employment_20_to_64),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(employment_20_to_64_moe, 1), "%<br/>",
                          "<strong> Percent employed between 20-64: <strong>", 
                          round(employment_20_to_64, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2017),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2017",
    fillColor = ~perc_emp_pal(employment_20_to_64),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(employment_20_to_64_moe, 1), "%<br/>",
                          "<strong> Percent employed between 20-64: <strong>", 
                          round(employment_20_to_64, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2016),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2016",
    fillColor = ~perc_emp_pal(employment_20_to_64),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(employment_20_to_64_moe, 1), "%<br/>",
                          "<strong> Percent employed between 20-64: <strong>", 
                          round(employment_20_to_64, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    data = filter(acs_tracts, year == 2015),
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2015",
    fillColor = ~perc_emp_pal(employment_20_to_64),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(employment_20_to_64_moe, 1), "%<br/>",
                          "<strong> Percent employed between 20-64: <strong>", 
                          round(employment_20_to_64, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#5e4b6b",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#8d9fcc",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    data = acs_tracts,
    "bottomright",
    pal = perc_emp_pal,
    values = ~ employment_20_to_64,
    labFormat = function(type, cuts, p) {
      n = length(cuts)
      p = paste0(round(p * 100), '%')
      cuts = paste0(formatC(cuts[-n]), " - ", formatC(cuts[-1]))},
    title = "Percent of Employed Adults<br>20 to 64 by Census Tract",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("2018", "2017", "2016", "2015"),
    options = layersControlOptions(collapsed = FALSE))
```

categories now!
(Income Distribution, Educational Attainment, Racial and Ethnic Diversity, and Family Stability.)
###Income Distribution
```{r}
income_dist <- dplyr::select(acs_tracts, NAME, year, contains("income"), geometry)%>% dplyr::select(!contains("moe"), -median_household_income)
income_dist_2018 <- filter(income_dist, year == 2018)
income_dist_2017 <- filter(income_dist, year == 2017)
income_dist_2016 <- filter(income_dist, year == 2016)
income_dist_2015 <- filter(income_dist, year == 2015)
income_dist_moe <- dplyr::select(acs_tracts, NAME, year, contains("income"), geometry) %>% select(!contains("total"))
```

leaflet income dist 2018
```{r}
income_dist_max_perc_2018 <- max(apply(X = select(data_frame(income_dist_2018),
                                                -year, -NAME, -geometry), 1, max, TRUE))
income_dist_18_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = c(0, income_dist_max_perc_2018))
income_dist_2018_leaf <- leaflet(income_dist_2018) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "< $10K",
    fillColor = ~income_dist_18_pal(income_less_than_10k),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2018$NAME, 20, 60), "<br/>",
                          substr(income_dist_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2018)$income_less_than_10k_moe, 1), "%<br/>",
                          "<strong> Percent earning < $10K: <strong>", 
                          round(income_less_than_10k, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$10K - $14999",
    fillColor = ~income_dist_18_pal(income_10k_14999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2018$NAME, 20, 60), "<br/>",
                          substr(income_dist_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2018)$income_10k_14999_moe, 1), "%<br/>",
                          "<strong> Percent earning $10K - $14999: <strong>", 
                          round(income_10k_14999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$15K - $24999",
    fillColor = ~income_dist_18_pal(income_15k_24999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2018$NAME, 20, 60), "<br/>",
                          substr(income_dist_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2018)$income_15k_24999_moe, 1), "%<br/>",
                          "<strong> Percent earning $15K - $24999: <strong>", 
                          round(income_15k_24999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$25K - $34999",
    fillColor = ~income_dist_18_pal(income_25k_34999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2018$NAME, 20, 60), "<br/>",
                          substr(income_dist_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2018)$income_25k_34999_moe, 1), "%<br/>",
                          "<strong> Percent earning $25K - $34999: <strong>", 
                          round(income_25k_34999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$35K - $49999",
    fillColor = ~income_dist_18_pal(income_35K_49999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2018$NAME, 20, 60), "<br/>",
                          substr(income_dist_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2018)$income_35K_49999_moe, 1), "%<br/>",
                          "<strong> Percent earning $35K - $49999: <strong>", 
                          round(income_35K_49999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$50K - $74999",
    fillColor = ~income_dist_18_pal(income_50K_74999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2018$NAME, 20, 60), "<br/>",
                          substr(income_dist_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2018)$income_50K_74999_moe, 1), "%<br/>",
                          "<strong> Percent earning $50K - $74999: <strong>", 
                          round(income_50K_74999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$75K - $99999",
    fillColor = ~income_dist_18_pal(income_75K_99999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2018$NAME, 20, 60), "<br/>",
                          substr(income_dist_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2018)$income_75K_99999_moe, 1), "%<br/>",
                          "<strong> Percent earning $75K - $99999: <strong>", 
                          round(income_75K_99999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$100K - $149999",
    fillColor = ~income_dist_18_pal(income_100K_149999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2018$NAME, 20, 60), "<br/>",
                          substr(income_dist_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2018)$income_100K_149999_moe, 1), "%<br/>",
                          "<strong> Percent earning $100K - $149999: <strong>", 
                          round(income_100K_149999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$150K - $199999",
    fillColor = ~income_dist_18_pal(income_150K_199999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2018$NAME, 20, 60), "<br/>",
                          substr(income_dist_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2018)$income_150K_199999_moe, 1), "%<br/>",
                          "<strong> Percent earning $150K - $199999: <strong>", 
                          round(income_150K_199999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "> $200K",
    fillColor = ~income_dist_18_pal(income_200K_more),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2018$NAME, 20, 60), "<br/>",
                          substr(income_dist_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2018)$income_200K_more, 1), "%<br/>",
                          "<strong> Percent earning > $200K: <strong>", 
                          round(income_200K_more, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = income_dist_18_pal,
    values = ~ c(0, income_dist_max_perc_2018),
    title = "% of Population in selected<br>Income Bracket by Census Tract (2018)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("< $10K", "$15K - $24999", "$25K - $34999", "$35K - $49999",
                   "$50K - $74999", "$75K - $99999","$100K - $149999", "$150K - $199999",
                   "> $200K"),
    options = layersControlOptions(collapsed = T))
```

leaflet income dist 2017
```{r}
income_dist_max_perc_2017 <- max(apply(X = select(data_frame(income_dist_2017),
                                                -year, -NAME, -geometry), 1, max, TRUE))
income_dist_17_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = c(0, income_dist_max_perc_2017))
income_dist_2017_leaf <- leaflet(income_dist_2017) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "< $10K",
    fillColor = ~income_dist_17_pal(income_less_than_10k),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2017$NAME, 20, 60), "<br/>",
                          substr(income_dist_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2017)$income_less_than_10k_moe, 1), "%<br/>",
                          "<strong> Percent earning < $10K: <strong>", 
                          round(income_less_than_10k, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$10K - $14999",
    fillColor = ~income_dist_17_pal(income_10k_14999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2017$NAME, 20, 60), "<br/>",
                          substr(income_dist_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2017)$income_10k_14999_moe, 1), "%<br/>",
                          "<strong> Percent earning $10K - $14999: <strong>", 
                          round(income_10k_14999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$15K - $24999",
    fillColor = ~income_dist_17_pal(income_15k_24999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2017$NAME, 20, 60), "<br/>",
                          substr(income_dist_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2017)$income_15k_24999_moe, 1), "%<br/>",
                          "<strong> Percent earning $15K - $24999: <strong>", 
                          round(income_15k_24999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$25K - $34999",
    fillColor = ~income_dist_17_pal(income_25k_34999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2017$NAME, 20, 60), "<br/>",
                          substr(income_dist_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2017)$income_25k_34999_moe, 1), "%<br/>",
                          "<strong> Percent earning $25K - $34999: <strong>", 
                          round(income_25k_34999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$35K - $49999",
    fillColor = ~income_dist_17_pal(income_35K_49999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2017$NAME, 20, 60), "<br/>",
                          substr(income_dist_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2017)$income_35K_49999_moe, 1), "%<br/>",
                          "<strong> Percent earning $35K - $49999: <strong>", 
                          round(income_35K_49999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$50K - $74999",
    fillColor = ~income_dist_17_pal(income_50K_74999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2017$NAME, 20, 60), "<br/>",
                          substr(income_dist_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2017)$income_50K_74999_moe, 1), "%<br/>",
                          "<strong> Percent earning $50K - $74999: <strong>", 
                          round(income_50K_74999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$75K - $99999",
    fillColor = ~income_dist_17_pal(income_75K_99999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2017$NAME, 20, 60), "<br/>",
                          substr(income_dist_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2017)$income_75K_99999_moe, 1), "%<br/>",
                          "<strong> Percent earning $75K - $99999: <strong>", 
                          round(income_75K_99999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$100K - $149999",
    fillColor = ~income_dist_17_pal(income_100K_149999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2017$NAME, 20, 60), "<br/>",
                          substr(income_dist_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2017)$income_100K_149999_moe, 1), "%<br/>",
                          "<strong> Percent earning $100K - $149999: <strong>", 
                          round(income_100K_149999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$150K - $199999",
    fillColor = ~income_dist_17_pal(income_150K_199999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2017$NAME, 20, 60), "<br/>",
                          substr(income_dist_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2017)$income_150K_199999_moe, 1), "%<br/>",
                          "<strong> Percent earning $150K - $199999: <strong>", 
                          round(income_150K_199999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "> $200K",
    fillColor = ~income_dist_17_pal(income_200K_more),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2017$NAME, 20, 60), "<br/>",
                          substr(income_dist_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2017)$income_200K_more, 1), "%<br/>",
                          "<strong> Percent earning > $200K: <strong>", 
                          round(income_200K_more, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = income_dist_17_pal,
    values = ~ c(0, income_dist_max_perc_2017),
    title = "% of Population in selected<br>Income Bracket by Census Tract (2017)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("< $10K", "$15K - $24999", "$25K - $34999", "$35K - $49999",
                   "$50K - $74999", "$75K - $99999","$100K - $149999", "$150K - $199999",
                   "> $200K"),
    options = layersControlOptions(collapsed = T))
```

leaflet income dist 2016
```{r}
income_dist_max_perc_2016 <- max(apply(X = select(data_frame(income_dist_2016),
                                                -year, -NAME, -geometry), 1, max, TRUE))
income_dist_16_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = c(0, income_dist_max_perc_2016))
income_dist_2016_leaf <- leaflet(income_dist_2016) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "< $10K",
    fillColor = ~income_dist_16_pal(income_less_than_10k),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2016$NAME, 20, 60), "<br/>",
                          substr(income_dist_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2016)$income_less_than_10k_moe, 1), "%<br/>",
                          "<strong> Percent earning < $10K: <strong>", 
                          round(income_less_than_10k, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$10K - $14999",
    fillColor = ~income_dist_16_pal(income_10k_14999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2016$NAME, 20, 60), "<br/>",
                          substr(income_dist_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2016)$income_10k_14999_moe, 1), "%<br/>",
                          "<strong> Percent earning $10K - $14999: <strong>", 
                          round(income_10k_14999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$15K - $24999",
    fillColor = ~income_dist_16_pal(income_15k_24999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2016$NAME, 20, 60), "<br/>",
                          substr(income_dist_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2016)$income_15k_24999_moe, 1), "%<br/>",
                          "<strong> Percent earning $15K - $24999: <strong>", 
                          round(income_15k_24999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$25K - $34999",
    fillColor = ~income_dist_16_pal(income_25k_34999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2016$NAME, 20, 60), "<br/>",
                          substr(income_dist_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2016)$income_25k_34999_moe, 1), "%<br/>",
                          "<strong> Percent earning $25K - $34999: <strong>", 
                          round(income_25k_34999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$35K - $49999",
    fillColor = ~income_dist_16_pal(income_35K_49999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2016$NAME, 20, 60), "<br/>",
                          substr(income_dist_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2016)$income_35K_49999_moe, 1), "%<br/>",
                          "<strong> Percent earning $35K - $49999: <strong>", 
                          round(income_35K_49999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$50K - $74999",
    fillColor = ~income_dist_16_pal(income_50K_74999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2016$NAME, 20, 60), "<br/>",
                          substr(income_dist_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2016)$income_50K_74999_moe, 1), "%<br/>",
                          "<strong> Percent earning $50K - $74999: <strong>", 
                          round(income_50K_74999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$75K - $99999",
    fillColor = ~income_dist_16_pal(income_75K_99999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2016$NAME, 20, 60), "<br/>",
                          substr(income_dist_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2016)$income_75K_99999_moe, 1), "%<br/>",
                          "<strong> Percent earning $75K - $99999: <strong>", 
                          round(income_75K_99999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$100K - $149999",
    fillColor = ~income_dist_16_pal(income_100K_149999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2016$NAME, 20, 60), "<br/>",
                          substr(income_dist_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2016)$income_100K_149999_moe, 1), "%<br/>",
                          "<strong> Percent earning $100K - $149999: <strong>", 
                          round(income_100K_149999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$150K - $199999",
    fillColor = ~income_dist_16_pal(income_150K_199999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2016$NAME, 20, 60), "<br/>",
                          substr(income_dist_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2016)$income_150K_199999_moe, 1), "%<br/>",
                          "<strong> Percent earning $150K - $199999: <strong>", 
                          round(income_150K_199999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "> $200K",
    fillColor = ~income_dist_16_pal(income_200K_more),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2016$NAME, 20, 60), "<br/>",
                          substr(income_dist_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2016)$income_200K_more, 1), "%<br/>",
                          "<strong> Percent earning > $200K: <strong>", 
                          round(income_200K_more, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = income_dist_16_pal,
    values = ~ c(0, income_dist_max_perc_2016),
    title = "% of Population in selected<br>Income Bracket by Census Tract (2016)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("< $10K", "$15K - $24999", "$25K - $34999", "$35K - $49999",
                   "$50K - $74999", "$75K - $99999","$100K - $149999", "$150K - $199999",
                   "> $200K"),
    options = layersControlOptions(collapsed = T))
```

leaflet income dist 2015
```{r}
income_dist_max_perc_2015 <- max(apply(X = select(data_frame(income_dist_2015),
                                                -year, -NAME, -geometry), 1, max, TRUE))
income_dist_15_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = c(0, income_dist_max_perc_2015))
income_dist_2015_leaf <- leaflet(income_dist_2015) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "< $10K",
    fillColor = ~income_dist_15_pal(income_less_than_10k),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2015$NAME, 20, 60), "<br/>",
                          substr(income_dist_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2015)$income_less_than_10k_moe, 1), "%<br/>",
                          "<strong> Percent earning < $10K: <strong>", 
                          round(income_less_than_10k, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$10K - $14999",
    fillColor = ~income_dist_15_pal(income_10k_14999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2015$NAME, 20, 60), "<br/>",
                          substr(income_dist_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2015)$income_10k_14999_moe, 1), "%<br/>",
                          "<strong> Percent earning $10K - $14999: <strong>", 
                          round(income_10k_14999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$15K - $24999",
    fillColor = ~income_dist_15_pal(income_15k_24999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2015$NAME, 20, 60), "<br/>",
                          substr(income_dist_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2015)$income_15k_24999_moe, 1), "%<br/>",
                          "<strong> Percent earning $15K - $24999: <strong>", 
                          round(income_15k_24999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$25K - $34999",
    fillColor = ~income_dist_15_pal(income_25k_34999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2015$NAME, 20, 60), "<br/>",
                          substr(income_dist_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2015)$income_25k_34999_moe, 1), "%<br/>",
                          "<strong> Percent earning $25K - $34999: <strong>", 
                          round(income_25k_34999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$35K - $49999",
    fillColor = ~income_dist_15_pal(income_35K_49999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2015$NAME, 20, 60), "<br/>",
                          substr(income_dist_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2015)$income_35K_49999_moe, 1), "%<br/>",
                          "<strong> Percent earning $35K - $49999: <strong>", 
                          round(income_35K_49999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$50K - $74999",
    fillColor = ~income_dist_15_pal(income_50K_74999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2015$NAME, 20, 60), "<br/>",
                          substr(income_dist_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2015)$income_50K_74999_moe, 1), "%<br/>",
                          "<strong> Percent earning $50K - $74999: <strong>", 
                          round(income_50K_74999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$75K - $99999",
    fillColor = ~income_dist_15_pal(income_75K_99999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2015$NAME, 20, 60), "<br/>",
                          substr(income_dist_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2015)$income_75K_99999_moe, 1), "%<br/>",
                          "<strong> Percent earning $75K - $99999: <strong>", 
                          round(income_75K_99999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$100K - $149999",
    fillColor = ~income_dist_15_pal(income_100K_149999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2015$NAME, 20, 60), "<br/>",
                          substr(income_dist_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2015)$income_100K_149999_moe, 1), "%<br/>",
                          "<strong> Percent earning $100K - $149999: <strong>", 
                          round(income_100K_149999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "$150K - $199999",
    fillColor = ~income_dist_15_pal(income_150K_199999),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2015$NAME, 20, 60), "<br/>",
                          substr(income_dist_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2015)$income_150K_199999_moe, 1), "%<br/>",
                          "<strong> Percent earning $150K - $199999: <strong>", 
                          round(income_150K_199999, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "> $200K",
    fillColor = ~income_dist_15_pal(income_200K_more),
    label = ~lapply(paste(sep = "", 
                          substr(income_dist_2015$NAME, 20, 60), "<br/>",
                          substr(income_dist_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(income_dist_moe, 
                                       year == 2015)$income_200K_more, 1), "%<br/>",
                          "<strong> Percent earning > $200K: <strong>", 
                          round(income_200K_more, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = income_dist_15_pal,
    values = ~ c(0, income_dist_max_perc_2015),
    title = "% of Population in selected<br>Income Bracket by Census Tract (2015)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("< $10K", "$15K - $24999", "$25K - $34999", "$35K - $49999",
                   "$50K - $74999", "$75K - $99999","$100K - $149999", "$150K - $199999",
                   "> $200K"),
    options = layersControlOptions(collapsed = T))
```

Viewing all income leaflets
```{r}
income_dist_2018_leaf
income_dist_2017_leaf
income_dist_2016_leaf
income_dist_2015_leaf
```


###Educational Attainment

```{r}
edu_attain <- dplyr::select(acs_tracts, NAME, year, contains("education"), geometry)
edu_attain <- select(edu_attain, !contains("moe"))
edu_attain_2018 <- filter(edu_attain, year == 2018)
edu_attain_2017 <- filter(edu_attain, year == 2017)
edu_attain_2016 <- filter(edu_attain, year == 2016)
edu_attain_2015 <- filter(edu_attain, year == 2015)
edu_attain_moe <- dplyr::select(acs_tracts, NAME, year, contains("education")) %>% select(!contains("total"))
```

educational attainment 2018
```{r}
edu_attain_max_perc_2018 <- max(apply(X = select(data_frame(edu_attain_2018),
                                                    -year, -NAME, -geometry), 1, max, TRUE))
edu_attain_2018_pal <- colorNumeric(viridis_pal(option = "D")(3),
                                      domain = c(0, edu_attain_max_perc_2018))

edu_attain_2018_leaf <- leaflet(edu_attain_2018) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Less than High School",
    fillColor = ~edu_attain_2018_pal(education_less_hs),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2018$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2018)$education_less_hs_moe, 1), "%<br/>",
                          "<strong> Percent < HS Education: <strong>", 
                          round(education_less_hs, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "High School Graduate",
    fillColor = ~edu_attain_2018_pal(education_hs_grad),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2018$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2018)$education_hs_grad_moe, 1), "%<br/>",
                          "<strong> Percent HS Graduate: <strong>", 
                          round(education_hs_grad, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Associates or Some College",
    fillColor = ~edu_attain_2018_pal(education_assoc_some_college),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2018$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2018)$education_assoc_some_college_moe, 1), "%<br/>",
                          "<strong> Percent AA or Some College: <strong>", 
                          round(education_assoc_some_college, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Bachelors or Higher",
    fillColor = ~edu_attain_2018_pal(education_bachelors_or_higher),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2018$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2018)$education_bachelors_or_higher_moe, 1), "%<br/>",
                          "<strong> Percent Bachelors or Higher: <strong>", 
                          round(education_bachelors_or_higher, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = edu_attain_2018_pal,
    values = ~ c(0, edu_attain_max_perc_2018),
    title = "% of Population with selected<br>Education Level by Census Tract (2018)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("Less than High School", "High School Graduate",
                   "Associates or Some College", "Bachelors or Higher"),
    options = layersControlOptions(collapsed = T))
```

educational attainment 2017
```{r}
edu_attain_max_perc_2017 <- max(apply(X = select(data_frame(edu_attain_2017),
                                                   -year, -NAME, -geometry), 1, max, TRUE))
edu_attain_2017_pal <- colorNumeric(viridis_pal(option = "D")(3),
                                      domain = c(0, edu_attain_max_perc_2017))

edu_attain_2017_leaf <- leaflet(edu_attain_2017) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "2017",
    fillColor = ~edu_attain_2017_pal(education_less_hs),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2017$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2017)$education_less_hs_moe, 1), "%<br/>",
                          "<strong> Percent < HS Education: <strong>", 
                          round(education_less_hs, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "High School Graduate",
    fillColor = ~edu_attain_2017_pal(education_hs_grad),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2017$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2017)$education_hs_grad_moe, 1), "%<br/>",
                          "<strong> Percent HS Graduate: <strong>", 
                          round(education_hs_grad, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Associates or Some College",
    fillColor = ~edu_attain_2017_pal(education_assoc_some_college),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2017$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2017)$education_assoc_some_college_moe, 1), "%<br/>",
                          "<strong> Percent AA or Some College: <strong>", 
                          round(education_assoc_some_college, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Bachelors or Higher",
    fillColor = ~edu_attain_2017_pal(education_bachelors_or_higher),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2017$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2017)$education_bachelors_or_higher_moe, 1), "%<br/>",
                          "<strong> Percent Bachelors or Higher: <strong>", 
                          round(education_bachelors_or_higher, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = edu_attain_2017_pal,
    values = ~ c(0, edu_attain_max_perc_2017),
    title = "% of Population with selected<br>Education Level by Census Tract (2017)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("Less than High School", "High School Graduate",
                   "Associates or Some College", "Bachelors or Higher"),
    options = layersControlOptions(collapsed = T))
```

educational attainment 2016
```{r}
edu_attain_max_perc_2016 <- max(apply(X = select(data_frame(edu_attain_2016),
                                                   -year, -NAME, -geometry), 1, max, TRUE))
edu_attain_2016_pal <- colorNumeric(viridis_pal(option = "D")(3),
                                      domain = c(0, edu_attain_max_perc_2016))

edu_attain_2016_leaf <- leaflet(edu_attain_2016) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Less than High School",
    fillColor = ~edu_attain_2016_pal(education_less_hs),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2016$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2016)$education_less_hs_moe, 1), "%<br/>",
                          "<strong> Percent < HS Education: <strong>", 
                          round(education_less_hs, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "High School Graduate",
    fillColor = ~edu_attain_2016_pal(education_hs_grad),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2016$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2016)$education_hs_grad_moe, 1), "%<br/>",
                          "<strong> Percent HS Graduate: <strong>", 
                          round(education_hs_grad, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Associates or Some College",
    fillColor = ~edu_attain_2016_pal(education_assoc_some_college),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2016$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2016)$education_assoc_some_college_moe, 1), "%<br/>",
                          "<strong> Percent AA or Some College: <strong>", 
                          round(education_assoc_some_college, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Bachelors or Higher",
    fillColor = ~edu_attain_2016_pal(education_bachelors_or_higher),
    label = ~lapply(paste(sep = "", 
                          substr(edu_attain_2016$NAME, 20, 60), "<br/>",
                          substr(edu_attain_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2016)$education_bachelors_or_higher_moe, 1), "%<br/>",
                          "<strong> Percent Bachelors or Higher: <strong>", 
                          round(education_bachelors_or_higher, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = edu_attain_2016_pal,
    values = ~ c(0, edu_attain_max_perc_2016),
    title = "% of Population with selected<br>Education Level by Census Tract (2016)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("Less than High School", "High School Graduate",
                   "Associates or Some College", "Bachelors or Higher"),
    options = layersControlOptions(collapsed = T))
```

educational attainment 2015
```{r}
edu_attain_max_perc_2015 <- max(apply(X = select(data_frame(edu_attain_2015),
                                                   -year, -NAME, -geometry), 1, max, TRUE))
edu_attain_2015_pal <- colorNumeric(viridis_pal(option = "D")(3),
                                      domain = c(0, edu_attain_max_perc_2015))
  
edu_attain_2015_leaf <- leaflet(edu_attain_2015) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Less than High School",
    fillColor = ~edu_attain_2015_pal(education_less_hs),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2015)$education_less_hs_moe, 1), "%<br/>",
                          "<strong> Percent < HS Education: <strong>", 
                          round(education_less_hs, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "High School Graduate",
    fillColor = ~edu_attain_2015_pal(education_hs_grad),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2015)$education_hs_grad_moe, 1), "%<br/>",
                          "<strong> Percent HS Graduate: <strong>", 
                          round(education_hs_grad, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Associates or Some College",
    fillColor = ~edu_attain_2015_pal(education_assoc_some_college),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2015)$education_assoc_some_college_moe, 1), "%<br/>",
                          "<strong> Percent AA or Some College: <strong>", 
                          round(education_assoc_some_college, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Bachelors or Higher",
    fillColor = ~edu_attain_2015_pal(education_bachelors_or_higher),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(edu_attain_moe, 
                                       year == 2015)$education_bachelors_or_higher_moe, 1), "%<br/>",
                          "<strong> Percent Bachelors or Higher: <strong>", 
                          round(education_bachelors_or_higher, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = edu_attain_2015_pal,
    values = ~ c(0, edu_attain_max_perc_2015),
    title = "% of Population with selected<br>Education Level by Census Tract (2015)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("Less than High School", "High School Graduate",
                   "Associates or Some College", "Bachelors or Higher"),
    options = layersControlOptions(collapsed = T))
```

```{r}
edu_attain_2018_leaf
edu_attain_2017_leaf
edu_attain_2016_leaf
edu_attain_2015_leaf
```


###Racial Diversity (over time)
```{r}
race_div <- dplyr::select(acs_tracts, NAME, year, contains("race"), geometry)
race_div <- select(race_div, !contains("moe"))
race_div_2018 <- filter(race_div, year == 2018)
race_div_2017 <- filter(race_div, year == 2017)
race_div_2016 <- filter(race_div, year == 2016)
race_div_2015 <- filter(race_div, year == 2015)
race_div_moe <- dplyr::select(acs_tracts, NAME, year, contains("race"), geometry) %>%
  select(!contains("total"))
race_div_white_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = race_div$race_white)
race_div_black_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = race_div$race_black)
race_div_na_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = race_div$race_american_indian)
race_div_asian_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = race_div$race_asian)
race_div_nh_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = race_div$race_native_hawaiian)
race_div_hisp_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = race_div$race_hispanic)
race_div_oth_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = race_div$race_other)
race_div_multi_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = race_div$race_two_more)
```

Racial Diversity 2018
```{r}
race_div_2018_leaf <- leaflet(race_div_2018) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  #white
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "White",
    fillColor = ~race_div_white_pal(race_white),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2018)$race_white_moe, 1), "%<br/>",
                          "<strong> Percent White: <strong>", 
                          round(race_white, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_white_pal,
    values = ~ race_white,
    group = "White",
    title = "% of Population identifying as<br>White by Census Tract (2018)",
    na.label = "NA")  %>%
  #black
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Black",
    fillColor = ~race_div_black_pal(race_black),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2018)$race_black_moe, 1), "%<br/>",
                          "<strong> Percent Black: <strong>", 
                          round(race_black, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_black_pal,
    values = ~ race_black,
    group = "Black",
    title = "% of Population identifying as<br>Black by Census Tract (2018)",
    na.label = "NA") %>%
  #NA
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Native American",
    fillColor = ~race_div_na_pal(race_american_indian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2018)$race_american_indian_moe, 1), "%<br/>",
                          "<strong> Percent Native American: <strong>", 
                          round(race_american_indian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_na_pal,
    values = ~ race_american_indian,
    group = "Native American",
    title = "% of Population identifying as<br>Native American by Census Tract (2018)",
    na.label = "NA") %>%
  #asian
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Asian",
    fillColor = ~race_div_asian_pal(race_asian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2018)$race_asian_moe, 1), "%<br/>",
                          "<strong> Percent Asian: <strong>", 
                          round(race_asian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_asian_pal,
    values = ~ race_asian,
    group = "Asian",
    title = "% of Population identifying as<br>Asian by Census Tract (2018)",
    na.label = "NA") %>%
  #nh
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Native Hawaiian",
    fillColor = ~race_div_nh_pal(race_native_hawaiian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2018)$race_native_hawaiian_moe, 1), "%<br/>",
                          "<strong> Percent Native Hawaiian: <strong>", 
                          round(race_native_hawaiian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_nh_pal,
    values = ~ race_native_hawaiian,
    group = "Native Hawaiian",
    title = "% of Population identifying as<br>Native Hawaiian by Census Tract (2018)",
    na.label = "NA") %>%
  #hispanic
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Hispanic",
    fillColor = ~race_div_hisp_pal(race_hispanic),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2018)$race_hispanic_moe, 1), "%<br/>",
                          "<strong> Percent Hispanic: <strong>", 
                          round(race_hispanic, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_hisp_pal,
    values = ~ race_hispanic,
    group = "Hispanic",
    title = "% of Population identifying as<br>Hispanic by Census Tract (2018)",
    na.label = "NA") %>%
  #other
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Other",
    fillColor = ~race_div_oth_pal(race_other),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2018)$race_other_moe, 1), "%<br/>",
                          "<strong> Percent Other: <strong>", 
                          round(race_other, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_oth_pal,
    values = ~ race_other,
    group = "Other",
    title = "% of Population identifying as<br>Other by Census Tract (2018)",
    na.label = "NA") %>%
  #multi
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Multiple Groups",
    fillColor = ~race_div_multi_pal(race_two_more),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2018)$race_two_more_moe, 1), "%<br/>",
                          "<strong> Percent Multiple Groups: <strong>", 
                          round(race_two_more, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_multi_pal,
    values = ~ race_two_more,
    group = "Multiple Groups",
    title = "% of Population identifying with<br>multiple racial groups by Census Tract (2018)",
    na.label = "NA") %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0) %>%
  addLayersControl(
    position = "topleft",
    overlayGroups = c("White", "Black", "Native American", "Asian", "Native Hawaiian",
              "Hispanic", "Other", "Multiple Groups"),
    options = layersControlOptions(collapsed = T)) %>%
  hideGroup(c("Black", "Native American", "Asian", "Native Hawaiian", 
              "Hispanic", "Other", "Multiple Groups"))

```

Racial Diversity 2017
```{r}
race_div_2017_leaf <- leaflet(race_div_2017) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  #white
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "White",
    fillColor = ~race_div_white_pal(race_white),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2017)$race_white_moe, 1), "%<br/>",
                          "<strong> Percent White: <strong>", 
                          round(race_white, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_white_pal,
    values = ~ race_white,
    group = "White",
    title = "% of Population identifying as<br>White by Census Tract (2017)",
    na.label = "NA")  %>%
  #black
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Black",
    fillColor = ~race_div_black_pal(race_black),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2017)$race_black_moe, 1), "%<br/>",
                          "<strong> Percent Black: <strong>", 
                          round(race_black, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_black_pal,
    values = ~ race_black,
    group = "Black",
    title = "% of Population identifying as<br>Black by Census Tract (2017)",
    na.label = "NA") %>%
  #NA
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Native American",
    fillColor = ~race_div_na_pal(race_american_indian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2017)$race_american_indian_moe, 1), "%<br/>",
                          "<strong> Percent Native American: <strong>", 
                          round(race_american_indian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_na_pal,
    values = ~ race_american_indian,
    group = "Native American",
    title = "% of Population identifying as<br>Native American by Census Tract (2017)",
    na.label = "NA") %>%
  #asian
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Asian",
    fillColor = ~race_div_asian_pal(race_asian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2017)$race_asian_moe, 1), "%<br/>",
                          "<strong> Percent Asian: <strong>", 
                          round(race_asian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_asian_pal,
    values = ~ race_asian,
    group = "Asian",
    title = "% of Population identifying as<br>Asian by Census Tract (2017)",
    na.label = "NA") %>%
  #nh
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Native Hawaiian",
    fillColor = ~race_div_nh_pal(race_native_hawaiian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2017)$race_native_hawaiian_moe, 1), "%<br/>",
                          "<strong> Percent Native Hawaiian: <strong>", 
                          round(race_native_hawaiian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_nh_pal,
    values = ~ race_native_hawaiian,
    group = "Native Hawaiian",
    title = "% of Population identifying as<br>Native Hawaiian by Census Tract (2017)",
    na.label = "NA") %>%
  #hispanic
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Hispanic",
    fillColor = ~race_div_hisp_pal(race_hispanic),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2017)$race_hispanic_moe, 1), "%<br/>",
                          "<strong> Percent Hispanic: <strong>", 
                          round(race_hispanic, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_hisp_pal,
    values = ~ race_hispanic,
    group = "Hispanic",
    title = "% of Population identifying as<br>Hispanic by Census Tract (2017)",
    na.label = "NA") %>%
  #other
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Other",
    fillColor = ~race_div_oth_pal(race_other),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2017)$race_other_moe, 1), "%<br/>",
                          "<strong> Percent Other: <strong>", 
                          round(race_other, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_oth_pal,
    values = ~ race_other,
    group = "Other",
    title = "% of Population identifying as<br>Other by Census Tract (2017)",
    na.label = "NA") %>%
  #multi
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Multiple Groups",
    fillColor = ~race_div_multi_pal(race_two_more),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2017)$race_two_more_moe, 1), "%<br/>",
                          "<strong> Percent Multiple Groups: <strong>", 
                          round(race_two_more, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_multi_pal,
    values = ~ race_two_more,
    group = "Multiple Groups",
    title = "% of Population identifying with<br>multiple racial groups by Census Tract (2017)",
    na.label = "NA") %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLayersControl(
    position = "topleft",
    overlayGroups = c("White", "Black", "Native American", "Asian", "Native Hawaiian",
              "Hispanic", "Other", "Multiple Groups"),
    options = layersControlOptions(collapsed = T)) %>%
  hideGroup(c("Black", "Native American", "Asian", "Native Hawaiian",
              "Hispanic", "Other", "Multiple Groups"))
```

Racial Diversity 2016
```{r}
race_div_2016_leaf <- leaflet(race_div_2016) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  #white
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "White",
    fillColor = ~race_div_white_pal(race_white),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2016)$race_white_moe, 1), "%<br/>",
                          "<strong> Percent White: <strong>", 
                          round(race_white, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_white_pal,
    values = ~ race_white,
    group = "White",
    title = "% of Population identifying as<br>White by Census Tract (2016)",
    na.label = "NA")  %>%
  #black
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Black",
    fillColor = ~race_div_black_pal(race_black),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2016)$race_black_moe, 1), "%<br/>",
                          "<strong> Percent Black: <strong>", 
                          round(race_black, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_black_pal,
    values = ~ race_black,
    group = "Black",
    title = "% of Population identifying as<br>Black by Census Tract (2016)",
    na.label = "NA") %>%
  #NA
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Native American",
    fillColor = ~race_div_na_pal(race_american_indian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2016)$race_american_indian_moe, 1), "%<br/>",
                          "<strong> Percent Native American: <strong>", 
                          round(race_american_indian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_na_pal,
    values = ~ race_american_indian,
    group = "Native American",
    title = "% of Population identifying as<br>Native American by Census Tract (2016)",
    na.label = "NA") %>%
  #asian
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Asian",
    fillColor = ~race_div_asian_pal(race_asian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2016)$race_asian_moe, 1), "%<br/>",
                          "<strong> Percent Asian: <strong>", 
                          round(race_asian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_asian_pal,
    values = ~ race_asian,
    group = "Asian",
    title = "% of Population identifying as<br>Asian by Census Tract (2016)",
    na.label = "NA") %>%
  #nh
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Native Hawaiian",
    fillColor = ~race_div_nh_pal(race_native_hawaiian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2016)$race_native_hawaiian_moe, 1), "%<br/>",
                          "<strong> Percent Native Hawaiian: <strong>", 
                          round(race_native_hawaiian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_nh_pal,
    values = ~ race_native_hawaiian,
    group = "Native Hawaiian",
    title = "% of Population identifying as<br>Native Hawaiian by Census Tract (2016)",
    na.label = "NA") %>%
  #hispanic
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Hispanic",
    fillColor = ~race_div_hisp_pal(race_hispanic),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2016)$race_hispanic_moe, 1), "%<br/>",
                          "<strong> Percent Hispanic: <strong>", 
                          round(race_hispanic, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_hisp_pal,
    values = ~ race_hispanic,
    group = "Hispanic",
    title = "% of Population identifying as<br>Hispanic by Census Tract (2016)",
    na.label = "NA") %>%
  #other
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Other",
    fillColor = ~race_div_oth_pal(race_other),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2016)$race_other_moe, 1), "%<br/>",
                          "<strong> Percent Other: <strong>", 
                          round(race_other, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_oth_pal,
    values = ~ race_other,
    group = "Other",
    title = "% of Population identifying as<br>Other by Census Tract (2016)",
    na.label = "NA") %>%
  #multi
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Multiple Groups",
    fillColor = ~race_div_multi_pal(race_two_more),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2016)$race_two_more_moe, 1), "%<br/>",
                          "<strong> Percent Multiple Groups: <strong>", 
                          round(race_two_more, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_multi_pal,
    values = ~ race_two_more,
    group = "Multiple Groups",
    title = "% of Population identifying with<br>multiple racial groups by Census Tract (2016)",
    na.label = "NA") %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLayersControl(
    position = "topleft",
    overlayGroups = c("White", "Black", "Native American", "Asian", "Native Hawaiian",
              "Hispanic", "Other", "Multiple Groups"),
    options = layersControlOptions(collapsed = T)) %>%
  hideGroup(c("Black", "Native American", "Asian", "Native Hawaiian",
              "Hispanic", "Other", "Multiple Groups"))
```

Racial Diversity 2015
```{r}
race_div_2015_leaf <- leaflet(race_div_2015) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  #white
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "White",
    fillColor = ~race_div_white_pal(race_white),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2015)$race_white_moe, 1), "%<br/>",
                          "<strong> Percent White: <strong>", 
                          round(race_white, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_white_pal,
    values = ~ race_white,
    group = "White",
    title = "% of Population identifying as<br>White by Census Tract (2015)",
    na.label = "NA")  %>%
  #black
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Black",
    fillColor = ~race_div_black_pal(race_black),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2015)$race_black_moe, 1), "%<br/>",
                          "<strong> Percent Black: <strong>", 
                          round(race_black, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_black_pal,
    values = ~ race_black,
    group = "Black",
    title = "% of Population identifying as<br>Black by Census Tract (2015)",
    na.label = "NA") %>%
  #NA
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Native American",
    fillColor = ~race_div_na_pal(race_american_indian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2015)$race_american_indian_moe, 1), "%<br/>",
                          "<strong> Percent Native American: <strong>", 
                          round(race_american_indian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_na_pal,
    values = ~ race_american_indian,
    group = "Native American",
    title = "% of Population identifying as<br>Native American by Census Tract (2015)",
    na.label = "NA") %>%
  #asian
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Asian",
    fillColor = ~race_div_asian_pal(race_asian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2015)$race_asian_moe, 1), "%<br/>",
                          "<strong> Percent Asian: <strong>", 
                          round(race_asian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_asian_pal,
    values = ~ race_asian,
    group = "Asian",
    title = "% of Population identifying as<br>Asian by Census Tract (2015)",
    na.label = "NA") %>%
  #nh
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Native Hawaiian",
    fillColor = ~race_div_nh_pal(race_native_hawaiian),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2015)$race_native_hawaiian_moe, 1), "%<br/>",
                          "<strong> Percent Native Hawaiian: <strong>", 
                          round(race_native_hawaiian, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_nh_pal,
    values = ~ race_native_hawaiian,
    group = "Native Hawaiian",
    title = "% of Population identifying as<br>Native Hawaiian by Census Tract (2015)",
    na.label = "NA") %>%
  #hispanic
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Hispanic",
    fillColor = ~race_div_hisp_pal(race_hispanic),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2015)$race_hispanic_moe, 1), "%<br/>",
                          "<strong> Percent Hispanic: <strong>", 
                          round(race_hispanic, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_hisp_pal,
    values = ~ race_hispanic,
    group = "Hispanic",
    title = "% of Population identifying as<br>Hispanic by Census Tract (2015)",
    na.label = "NA") %>%
  #other
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Other",
    fillColor = ~race_div_oth_pal(race_other),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2015)$race_other_moe, 1), "%<br/>",
                          "<strong> Percent Other: <strong>", 
                          round(race_other, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_oth_pal,
    values = ~ race_other,
    group = "Other",
    title = "% of Population identifying as<br>Other by Census Tract (2015)",
    na.label = "NA") %>%
  #multi
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "Multiple Groups",
    fillColor = ~race_div_multi_pal(race_two_more),
    label = ~lapply(paste(sep = "", 
                          substr(NAME, 20, 60), "<br/>",
                          substr(NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(race_div_moe, 
                                       year == 2015)$race_two_more_moe, 1), "%<br/>",
                          "<strong> Percent Multiple Groups: <strong>", 
                          round(race_two_more, 1), "<strong>%"),
                    htmltools::HTML)) %>% 
  addLegend(
    "bottomright",
    pal = race_div_multi_pal,
    values = ~ race_two_more,
    group = "Multiple Groups",
    title = "% of Population identifying with<br>multiple racial groups by Census Tract (2015)",
    na.label = "NA") %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLayersControl(
    position = "topleft",
    overlayGroups = c("White", "Black", "Native American", "Asian", "Native Hawaiian",
              "Hispanic", "Other", "Multiple Groups"),
    options = layersControlOptions(collapsed = T)) %>%
  hideGroup(c("Black", "Native American", "Asian", "Native Hawaiian",
              "Hispanic", "Other", "Multiple Groups"))
```

viewing all maps
```{r}
race_div_2018_leaf
race_div_2017_leaf
race_div_2016_leaf
race_div_2015_leaf
```


###Family Stability
```{r}
fam_stab <- dplyr::select(acs_tracts, NAME, year, contains("family"), geometry)
fam_stab <- select(fam_stab, !contains("moe")) %>% select(!contains("total"))
fam_stab_2018 <- filter(fam_stab, year == 2018)
fam_stab_2017 <- filter(fam_stab, year == 2017)
fam_stab_2016 <- filter(fam_stab, year == 2016)
fam_stab_2015 <- filter(fam_stab, year == 2015)
fam_stab_moe <- dplyr::select(acs_tracts, NAME, year, contains("family"), geometry) %>% select(!contains("total"))
```

family stability 2018
```{r}
fam_stab_max_perc_2018 <- max(apply(X = select(data_frame(fam_stab_2018), -year, -NAME, -geometry), MARGIN = 1, FUN = max, na.rm = TRUE))
fam_stab_2018_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = c(0, fam_stab_max_perc_2018))
fam_stab_2018_leaf <- leaflet(fam_stab_2018) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Parents who are Married",
    fillColor = ~fam_stab_2018_pal(family_married_parent_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2018$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2018)$family_married_parent_perc_moe, 1), "%<br/>",
                          "<strong> Percent Married: <strong>", 
                          round(family_married_parent_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Single Fathers",
    fillColor = ~fam_stab_2018_pal(family_single_parent_male_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2018$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2018)$family_single_parent_male_perc_moe, 1), 
                          "%<br/>",
                          "<strong> Percent of Single Fathers: <strong>", 
                          round(family_single_parent_male_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
    addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Single Mothers",
    fillColor = ~fam_stab_2018_pal(family_single_parent_female_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2018$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2018)$family_single_parent_female_perc_moe, 1), 
                          "%<br/>",
                          "<strong> Percent of Single Mothers: <strong>", 
                          round(family_single_parent_female_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Children in Nonfamily Household",
    fillColor = ~fam_stab_2018_pal(family_children_nonfamily_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2018$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2018$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2018)$family_children_nonfamily_perc_moe,
                                1), "%<br/>",
                          "<strong> Percent Children in Nonfamily Household: <strong>", 
                          round(family_children_nonfamily_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = fam_stab_2018_pal,
    values = ~ c(0, fam_stab_max_perc_2018),
    title = "% of Parents with selected Family Stability<br>Indicator by Census Tract (2018)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("% of Parents who are Married", "% of Single Fathers", "% of Single Mothers", 
                   "% of Children in Nonfamily Household"),
    options = layersControlOptions(collapsed = F))
```

family stability 2017
```{r}
fam_stab_max_perc_2017 <- max(apply(X = select(data_frame(fam_stab_2017), -year, -NAME, -geometry), MARGIN = 1, FUN = max, na.rm = TRUE))
fam_stab_2017_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = c(0, fam_stab_max_perc_2017))
fam_stab_2017_leaf <- leaflet(fam_stab_2017) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Parents who are Married",
    fillColor = ~fam_stab_2017_pal(family_married_parent_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2017$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2017)$family_married_parent_perc_moe, 1), "%<br/>",
                          "<strong> Percent Married: <strong>", 
                          round(family_married_parent_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Single Fathers",
    fillColor = ~fam_stab_2017_pal(family_single_parent_male_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2017$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2017)$family_single_parent_male_perc_moe, 1), 
                          "%<br/>",
                          "<strong> Percent of Single Fathers: <strong>", 
                          round(family_single_parent_male_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
    addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Single Mothers",
    fillColor = ~fam_stab_2017_pal(family_single_parent_female_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2017$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2017)$family_single_parent_female_perc_moe, 1), 
                          "%<br/>",
                          "<strong> Percent of Single Mothers: <strong>", 
                          round(family_single_parent_female_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Children in Nonfamily Household",
    fillColor = ~fam_stab_2017_pal(family_children_nonfamily_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2017$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2017$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2017)$family_children_nonfamily_perc_moe,
                                1), "%<br/>",
                          "<strong> Percent Children in Nonfamily Household: <strong>", 
                          round(family_children_nonfamily_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = fam_stab_2017_pal,
    values = ~ c(0, fam_stab_max_perc_2017),
    title = "% of Parents with selected Family Stability<br>Indicator by Census Tract (2017)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("% of Parents who are Married", "% of Single Fathers", "% of Single Mothers", 
                   "% of Children in Nonfamily Household"),
    options = layersControlOptions(collapsed = F))
```

family stability 2016
```{r}
fam_stab_max_perc_2016 <- max(apply(X = select(data_frame(fam_stab_2016), -year, -NAME, -geometry), MARGIN = 1, FUN = max, na.rm = TRUE))
fam_stab_2016_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = c(0, fam_stab_max_perc_2016))
fam_stab_2016_leaf <- leaflet(fam_stab_2016) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Parents who are Married",
    fillColor = ~fam_stab_2016_pal(family_married_parent_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2016$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2016)$family_married_parent_perc_moe, 1), "%<br/>",
                          "<strong> Percent Married: <strong>", 
                          round(family_married_parent_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Single Fathers",
    fillColor = ~fam_stab_2016_pal(family_single_parent_male_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2016$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2016)$family_single_parent_male_perc_moe, 1), 
                          "%<br/>",
                          "<strong> Percent of Single Fathers: <strong>", 
                          round(family_single_parent_male_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
    addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Single Mothers",
    fillColor = ~fam_stab_2016_pal(family_single_parent_female_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2016$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2016)$family_single_parent_female_perc_moe, 1), 
                          "%<br/>",
                          "<strong> Percent of Single Mothers: <strong>", 
                          round(family_single_parent_female_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Children in Nonfamily Household",
    fillColor = ~fam_stab_2016_pal(family_children_nonfamily_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2016$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2016$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2016)$family_children_nonfamily_perc_moe,
                                1), "%<br/>",
                          "<strong> Percent Children in Nonfamily Household: <strong>", 
                          round(family_children_nonfamily_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = fam_stab_2016_pal,
    values = ~ c(0, fam_stab_max_perc_2016),
    title = "% of Parents with selected Family Stability<br>Indicator by Census Tract (2016)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("% of Parents who are Married", "% of Single Fathers", "% of Single Mothers", 
                   "% of Children in Nonfamily Household"),
    options = layersControlOptions(collapsed = F))
```

family stability 2015
```{r}
fam_stab_max_perc_2015 <- max(apply(X = select(data_frame(fam_stab_2015), -year, -NAME, -geometry), MARGIN = 1, FUN = max, na.rm = TRUE))
fam_stab_2015_pal <- colorNumeric(viridis_pal(option = "D")(3), 
                                   domain = c(0, fam_stab_max_perc_2015))
fam_stab_2015_leaf <- leaflet(fam_stab_2015) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Parents who are Married",
    fillColor = ~fam_stab_2015_pal(family_married_parent_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2015$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2015)$family_married_parent_perc_moe, 1), "%<br/>",
                          "<strong> Percent Married: <strong>", 
                          round(family_married_parent_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Single Fathers",
    fillColor = ~fam_stab_2015_pal(family_single_parent_male_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2015$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2015)$family_single_parent_male_perc_moe, 1), 
                          "%<br/>",
                          "<strong> Percent of Single Fathers: <strong>", 
                          round(family_single_parent_male_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
    addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Single Mothers",
    fillColor = ~fam_stab_2015_pal(family_single_parent_female_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2015$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2015)$family_single_parent_female_perc_moe, 1), 
                          "%<br/>",
                          "<strong> Percent of Single Mothers: <strong>", 
                          round(family_single_parent_female_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolygons(
    weight = 1,
    opacity = 0,
    fillOpacity = .7,
    group = "% of Children in Nonfamily Household",
    fillColor = ~fam_stab_2015_pal(family_children_nonfamily_perc),
    label = ~lapply(paste(sep = "", 
                          substr(fam_stab_2015$NAME, 20, 60), "<br/>",
                          substr(fam_stab_2015$NAME, 1, 17), 
                          "<br/>Margins of error: ",
                          round(filter(fam_stab_moe, 
                                       year == 2015)$family_children_nonfamily_perc_moe,
                                1), "%<br/>",
                          "<strong> Percent Children in Nonfamily Household: <strong>", 
                          round(family_children_nonfamily_perc, 1), "<strong>%"),
                    htmltools::HTML)) %>%
  addPolylines(
    data = south_wasco_points,
    color = "#ffce9e",
    weight = 2,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap",
    label = "South Wasco County Region") %>%
  addPolylines(
    data = county_lines,
    color = "#d48537",
    weight = 1,
    opacity = 1,
    fillOpacity= 0,
    group = "Basemap") %>%
  addLegend(
    "bottomright",
    pal = fam_stab_2015_pal,
    values = ~ c(0, fam_stab_max_perc_2015),
    title = "% of Parents with selected Family Stability<br>Indicator by Census Tract (2015)",
    na.label = "NA") %>%
  addLayersControl(
    baseGroups = c("% of Parents who are Married", "% of Single Fathers", "% of Single Mothers", 
                   "% of Children in Nonfamily Household"),
    options = layersControlOptions(collapsed = F))
```

Viewing all fam
```{r}
fam_stab_2018_leaf
fam_stab_2017_leaf
fam_stab_2016_leaf
fam_stab_2015_leaf
```

